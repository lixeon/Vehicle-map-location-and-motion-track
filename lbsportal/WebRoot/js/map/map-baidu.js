(function(){var f=13;var b={dragend:"dragend",zoomend:"zoomend",moveend:"moveend"};var h="map_canvas";var q="panel_map_toolbar";var j=null;var k=null;var n={};var o=null;var e=function(){};function p(v){h=v.panelId;q=v.toolbarId;var u=$(window).width()-1*2;var w=$(window).height()-$("#panel_header").height()-2*2;$("#"+h).css({height:w+"px",width:u+"px"});$("#"+q).css({"margin-left":(u*0.618)-40*4+"px"});$("#"+q).show();j=new BMap.Map(h);j.centerAndZoom(new BMap.Point(parseFloat(vp.v.city_clng),parseFloat(vp.v.city_clat)),v.zoom||f);j.setMaxZoom(19);j.addControl(new BMap.NavigationControl());var x=new BMap.MapTypeControl({mapTypes:[BMAP_NORMAL_MAP,BMAP_HYBRID_MAP]});x.setAnchor(BMAP_ANCHOR_TOP_LEFT);x.setOffset(new BMap.Size(80,15));j.addControl(x);j.enableScrollWheelZoom();j.enableContinuousZoom();j.enableInertialDragging();k=new BMapLib.DistanceTool(j);$("#btn_map_measuredistance").click(function(){k.open()})}function s(y){d(y.mkid);var w=vp.m.adjustXY(y.x,y.y);var A=new BMap.Point(w.x,w.y);var u=new BMap.Marker(A,{title:y.name,icon:(y.imgUrl)?new BMap.Icon(y.imgUrl,new BMap.Size(40,40),{imageOffset:new BMap.Size(10,10)}):null});var v=y.name;if(y.label){v=y.label.content}u.setLabel(new BMap.Label(v,{position:A,offset:new BMap.Size(25,25)}));if(y.center){j.panTo(A)}else{if(y.inView){var x=j.getBounds();if(!x.containsPoint(A)){j.panTo(A)}}}if(y.infoWin){var z=new BMap.InfoWindow(y.infoWin.content,{title:y.infoWin.title});u.addEventListener("click",function(){this.openInfoWindow(z)})}j.addOverlay(u);n["#MM"+y.mkid]=u}function d(v){var u=n["#MM"+v];if(u!=null){n["#MM"+v]=null;j.removeOverlay(u)}}function g(y){var x=[];var v=null;for(var w=0;w<y.xs.length;w++){v=vp.m.adjustXY(parseFloat(y.xs[w]),parseFloat(y.ys[w]));x.push(new BMap.Point(v.x,v.y))}var u=new BMap.Polyline(x,{strokeColor:y.color||"#0000ff",strokeOpacity:0.75,strokeWeight:4});j.addOverlay(u);n["#ML"+y.lid]=u}function i(v){var u=n["#ML"+v];if(u!=null){n["#ML"+v]=null;j.removeOverlay(u)}}function r(u,v){$("#"+h).css({height:v+"px",width:u+"px"});$("#"+q).css({"margin-left":(u*0.618)-40*4+"px"})}function t(u,v){if(u=="zoom"){if(v==undefined){return j.getZoom()}else{j.setZoom(v)}}}function m(){var u=j.getBounds();var v={swx:u.getSouthWest().lng,swy:u.getSouthWest().lat,nex:u.getNorthEast().lng,ney:u.getNorthEast().lat};return v}function a(){for(var u in n){if(n[u]!=null){j.removeOverlay(n[u]);n[u]=null}}}function l(w,v){var u=b[w];if(u!=null){j.addEventListener(w,v)}}function c(v,u){}vp.m.init=p;vp.m.resize=r;vp.m.showLoc=s;vp.m.removeMark=d;vp.m.drawLine=g;vp.m.removeLine=i;vp.m.mapConfig=t;vp.m.getMapBounds=m;vp.m.clearAll=a;vp.m.registerEvent=l;vp.m.unregisterEvent=c})();